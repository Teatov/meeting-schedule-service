API о сотрудниках, собраниях и расписаниях
==========================================

* * *

Основываясь на принципах REST, этот API предоставляет конечные точки для операций над сотрудниками, собраниями и для составления расписаний для сотрудников.  

Описание
--------

##### Запросы

Доступ к ресурсам может быть получен через стандартные HTTP запросы в формате UTF-8, отправленные к нужной конечной точке.  
Для каждой операции API использует соответствующие HTTP методы:

Метод

Операция

GET

Получить ресурс

POST

Создать ресурс

PATCH

Изменить ресурс

DELETE

Удалить ресурс

##### Ответы

Ответы содержат JSON объект. Документация конечных точек описывает типичные ответы от каждой из них.

##### Дата и время

Даты имеют формат `ГГГГ-ММ-ДД`. Время имеет формат `ЧЧ:ММ:СС` или `ЧЧ:ММ`.

##### Постраничная навигация

Конечные точки, возвращающие коллекции ресурсов, автоматически разбиваются на страницы.  
Одна страница содержит 20 ресурсов. Нумерация страниц начинается с 1.  
Можно выбирать страницу, добавляя параметр запроса `page`:

    http://meetings.test/v1/appointments?page=2

Информация о пагинации включена в HTTP ответ в следующих заголовках:

Заголовок

Описание

X-Pagination-Total-Count

Общее количество ресурсов

X-Pagination-Page-Count

Количество страниц

X-Pagination-Current-Page

Номер текущей страницы

X-Pagination-Per-Page

Количество ресурсов на одну страницу

Link

Список навигационных ссылок для всех страниц

* * *

Быстрый старт
-------------

##### Установка

1.  Откройте командную строку в папке приложения и запустите следующую команду, чтобы установить необходимые расширения:
    
        composer install
    
    Затем запустите следующую команду, чтобы проверить требования:
    
        php requirements.php
    
2.  Откройте файл `config/db.php` и измените параметры на верные для вашей базы данных.  
    По умолчанию этот файл содержит следующее:
    
        <?php
        
            return [
                'class' => 'yii\db\Connection',
                'dsn' => 'mysql:host=127.0.0.1;dbname=meeting_schedule_service',
                'username' => 'root',
                'password' => '',
                'charset' => 'utf8',
            ];
    
3.  Подключите приложение к вашему серверу Apache или Nginx.  
    Создайте для него виртуальный хост с именем `meetings.test`.
4.  Запустите сервер и проверьте подключение, открыв адрес `http://meetings.test/`

* * *

Ресурсы
-------

##### Сотрудники

Каждый сотрудник имеет имя и должность.  
С каждым сотрудником связаны собрания, на которые он назначен.  
Для каждого сотрудника можно составить расписание на указанный день, при котором он сможет посетить максимальное количество собраний.  
  
Структура:

Поле

Тип данных

Описание

Правила

id

int

ID сотрудника.

Заполняется автоматически.

name

string

Полное имя сотрудника.

Обязательно.

title

string

Должность сотрудника.

Необязательно.

meetings

array

Список собраний, на которые назначен сотрудник.

По умолчанию скрыто.

##### Собрания

Каждое собрание имеет дату, время начала, время конца и тему.  
С каждым собранием связаны сотрудники, которые на него назначены.  
  
Структура:

Поле

Тип данных

Описание

Правила

id

int

ID собрания.

Заполняется автоматически.

date

string

Дата собрания.

Обязательно.

start\_time

string

Время начала собрания.

Обязательно. Не может быть позже конца.

end\_time

string

Время конца собрания.

Обязательно.

topic

string

Тема собрания.

Необязательно.

employees

array

Список сотрудников, которые назначены на собрание.

По умолчанию скрыто.

##### Связи между сотрудниками и собраниями

Связующие звенья между сотрудниками и собраниями.  
Каждая связь соединяет одного сотрудника и одно собрание.  
Один сотрудник может быть связан со многими собраниями, а собрание - со многими сотрудниками.  
  
Структура:

Поле

Тип данных

Описание

Правила

meeting\_id

int

ID собрания.

Обязательно.

employee\_id

int

ID сотрудника.

Обязательно.

* * *

Конечные точки
--------------

Базовый адрес для всех запросов - `http://meetings.test/v1`.

##### Параметры запроса

К каждому запросу можно добавить параметры для пагинации, фильтрации и сортировки коллекций, а также для скрытия и добавления полей ресурсов:

Параметр

Описание

Пример

page

Переносит на заданную страницу.

`http://meetings.test/v1/appointments?page=3`

filter\[{field}\]\[{control}\]

Фильтрует коллекцию и возвращает только те ресурсы,  
в которых поля соответствуют условию.  
По умолчанию проверяет на равенство, но можно  
указать другие операторы в {control}. ([Доступные операторы](https://www.yiiframework.com/doc/api/2.0/yii-data-datafilter#$filterControls-detail))

`http://meetings.test/v1/meetings?filter[start_time]=03:00:00`  
`http://meetings.test/v1/appointments?filter[employee_id][gt]=3`

sort

Сортирует коллекцию по заданному полю.

`http://meetings.test/v1/meetings?sort=date`

fields

Скрывает из ресурсов все поля кроме заданных.  
Поля перечисляются через запятую без пробелов.

`http://meetings.test/v1/employees?fields=name,title`

expand

Добавляет в ресурсы поля, которые по умолчанию скрыты.

`http://meetings.test/v1/employees?expand=meetings`  
`http://meetings.test/v1/meetings?expand=employees`

##### /employees

Позволяет выполнять CRUD-операции над сотрудниками, а также составлять расписания.  
Ресурс имеет скрытое поле `meetings`, которое можно добавить параметром `expand`.  
  
GET /employees - вывод списка всех сотрудников.  
Пример ответа:

    [    {        "id": 1,        "name": "Otto Hastie",        "title": "Analog Circuit Design manager"    },    {        "id": 2,        "name": "Cornelius Slyde",        "title": "Teacher"    },    {        "id": 3,        "name": "Vinny Pizzapasta",        "title": "VP Quality Control"    }]

  
GET /employees/{id} - вывод сотрудника по `{id}`.  
Пример запроса: `http://meetings.test/v1/employees/4?expand=meetings`  
Пример ответа:

    {    "id": 4,
            "name": "Vinny Pizzapasta",
            "title": "VP Quality Control",
            "meetings": [
                {
                    "id": 63,
                    "date": "2022-10-07",
                    "start_time": "01:00:00",
                    "end_time": "02:00:00",
                    "topic": "Commercial distribution"
                }
            ]
        }

  
POST /employees - создание нового сотрудника.  
Пример тела запроса:

    {    "name": "Alexander Hamilton",
            "title": "Secretary"
        }

  
PATCH /employees/{id} - обновление информации о сотруднике по `{id}`.  
Пример тела запроса:

    {    "title": "Accountant"
        }

  
DELETE /employees/{id} - удаление сотрудника по `{id}`.  
  
GET /employees/{id}/build-schedule?date={date} - составление расписания для сотрудника по `{id}` в день `{date}`.  
Пример запроса: `http://meetings.test/v1/employees/4/build-schedule?date=2022-10-07`  
Пример ответа:

    [    {
                "id": 63,
                "date": "2022-10-07",
                "start_time": "01:00:00",
                "end_time": "02:00:00",
                "topic": "Commercial distribution"
            },
            {
                "id": 64,
                "date": "2022-10-07",
                "start_time": "02:00:00",
                "end_time": "04:00:00",
                "topic": "Money"
            },
            {
                "id": 67,
                "date": "2022-10-07",
                "start_time": "05:00:00",
                "end_time": "06:00:00",
                "topic": "Small talk"
            }
        ]

  
  

##### /meetings

Позволяет выполнять CRUD-операции над собраниями.  
Ресурс имеет скрытое поле `employees`, которое можно добавить параметром `expand`.  
  
GET /meetings - вывод списка всех собраний.  
Пример ответа:

    [    {
                "id": 62,
                "date": "2022-10-07",
                "start_time": "00:00:00",
                "end_time": "04:00:00",
                "topic": "Business business"
            },
            {
                "id": 63,
                "date": "2022-10-07",
                "start_time": "01:00:00",
                "end_time": "02:00:00",
                "topic": "Commercial distribution"
            },
            {
                "id": 64,
                "date": "2022-10-07",
                "start_time": "02:00:00",
                "end_time": "04:00:00",
                "topic": "Money"
            }
        ]

  
GET /meetings/<id> - вывод собрания по `{id}`.  
Пример запроса: `http://meetings.test/v1/meetings/69?expand=employees`  
Пример ответа:

    {    "id": 69,
            "date": "2022-10-07",
            "start_time": "06:00:00",
            "end_time": "07:00:00",
            "topic": "Rooter: A Methodology for the Typical Unification of Access Points and Redundancy",
            "employees": [
                {
                    "id": 4,
                    "name": "Leland Gaskell",
                    "title": "VP Quality Control"
                }
            ]
        }

  
POST /meetings - создание нового собрания.  
Пример тела запроса:

    {    "start_time": "08:00",
            "end_time": "10:00",
            "date": "2022-10-07",
            "topic": "Important attend ALL",
            "employees": [
                {
                    "id": 2
                },
                {
                    "name": "Babb Ferens"
                },
                {
                    "id": 4
                }
            ]
        }

  
PATCH /meetings/<id> - обновление информации о собрании по `{id}`.  
Пример тела запроса:

    {
            "date": "2022-10-07",
            "topic": "Not very important tbh"
        }

  
DELETE /meetings/<id> - удаление собрания по `{id}`.  
  

##### /appointments

Позволяет выполнять операции над связями между сотрудниками и собраниями.  
GET /appointments - вывод списка всех связей.  
Пример ответа:

    [    {
                "meeting_id": 62,
                "employee_id": 4
            },
            {
                "meeting_id": 62,
                "employee_id": 6
            },
            {
                "meeting_id": 64,
                "employee_id": 4
            }
        ]

  
POST /appointments - создание новой связи.  
Пример тела запроса:

    {    "meeting_id": 21,
            "employee_id": 2
        }

  

* * *

  
Титов Анатолий 2022